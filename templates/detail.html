<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta property="og:title" content="MUMA(Museum Masters)" />
    <meta property="og:description" content="ÎÆ§ÏßÄÏóÑ ÎßàÏä§ÌÑ∞Îì§ÏùÑ ÏúÑÌïú Î∞ïÎ¨ºÍ¥ÄÏóê ÎåÄÌïú Ï†ïÎ≥¥Î•º Í≥µÏú†ÌïòÍ≥† ÌõÑÍ∏∞Î•º ÎÇ®Í∏∞Îäî Í≥µÍ∞ÑÏûÖÎãàÎã§." />
    <meta property="og:image" content="http://res.heraldm.com/content/image/2020/05/05/20200505000141_0.jpg" />
<!--    staticÌè¥Îçî Ï†ÄÏû• Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïö©Ïãú -->
<!--    <meta property="og:image" content="{{ url_for('static', filename='logo_red.png') }}"/>-->

    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

<!--    ÏßÄÎèÑ api -->
    <script type="text/javascript"
            src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=afrl6tl1y2"></script>
    <script src=" https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <title>MUMA | detail_pg_name </title>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">


    <style>
        /*COMMON*/
        body {
            font-size: 16px;
            font-weight: 400;
            line-height: 1.2;
            font-family: 'Nanum Gothic', sans-serif;
            color: #333333;
        }
        hr {
            width: 100%;
            max-width: 800px;
        }
        #map {
            width: 100%;
            max-width: 800px;
            height: 400px;
            margin: 35px auto;
        }

        /*HEADER*/
        .mytitle {
            background-color: whitesmoke;
            font-size: 14px;
        }
        .mytitle .inner {
            width: 100%;
            max-width: 800px;
            height: 80px;
            margin: 0 auto;
            position: relative;
        }
        .mytitle .logo {
            height: 40px;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            margin: auto;
            font-size: 24px;
            color: #333333;
            text-decoration: none;
        }

        .mytitle .sub-menu {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            margin: auto;
            height: 40px;
            display: flex;
            flex-direction: row;
        }
        .mytitle .sub-menu .search input {
            width: 200px;
            height: 40px;
            padding: 2px 10px;
            border-radius: 5px;
            outline: none;
            background-color: white;
            color: gray;
            font-size: 14px;
            border: 1px solid #b0b0b0;
        }

        .mytitle .sub-menu .search .search-btn {
            width: 100px;
            height: 40px;

            background-color: #0066cc;
            color: white;
            border-radius: 5px;
            border: 1px solid #0066cc;
        }
        .mytitle .sub-menu .search .search-btn:hover {
            background-color: #333333;
            border: 1px solid #333333;
        }
        .mytitle .sub-menu .logout-btn {
            width: 100px;
            height: 40px;

            margin-left: 3px;
            background-color: #b0b0b0;
            color: white;
            border-radius: 5px;
            border: 1px solid #b0b0b0;
        }
        .mytitle .sub-menu .logout-btn:hover {
            background-color: #333333;
        }


        /*MAIN DB SHOW*/
        .showdb {
            margin-top: 50px
        }
        .showdb .dbinfo {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: row;
        }
        .showdb .dbinfo .dbimg img {
            background-color: orange;
            width: 100%;
            min-width: 350px;
            height: auto;
            flex-grow: 1;
            object-fit: contain;
        }

        .showdb .dbinfo .dbmain {
            overflow: hidden;
            margin-top: 10px;
            min-width: 350px;
            width: 100%;
            padding-left: 35px;
            flex-grow: 1;
        }
        .showdb .dbinfo .dbmain .db-head {
            display: flex;
            flex-direction: row;
            margin-bottom: 10px;
        }
        .showdb .dbinfo .dbmain .info_head {
            font-weight: 700;
        }
        .showdb .dbinfo .dbmain .type {
            color: #0066cc;
            font-size: 16px;
            font-weight: 700;
            font-style: italic;
            margin-top: 5px;
            margin-left: 15px;
        }
        .showdb .dbinfo .dbmain .name {
            font-size: 24px;
            font-weight: 700;
        }
        .showdb .dbinfo .dbmain .db-intro {
            line-height: 1.6;
        }

        .showdb .dbinfo .dbmain .show_map {
            text-decoration : none;
        }

        .showdb .dbinfo .dbmain .input-group {
            margin-top: 30px;
        }

        .showdb .dbinfo btns {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: auto;
        }

        /*COMMENT*/
        .mycomment {
            width: 100%;
            max-width: 800px;
            margin: 35px auto;
            display: flex;
            flex-direction: row;
            align-items: center;
            position: relative;
        }
        .mycomment .mystar .form-select {
            color: gray;
            outline: none;
            box-shadow: none;
            width: 150px;
        }
        .mycomment .input-group {
            margin-top: 16px;
            margin-left: 10px;
        }
        .mycomment .input-group .form-control {
            outline: none;
            box-shadow: none;
        }
        .mycomment .input-group .btn-outline-secondary {
            border: 1px solid lightgray;
            outline: none;
            box-shadow: none;
        }
        .mycomment .input-group .btn-outline-secondary:hover {
            background-color: #333333;
            border: 1px solid #333333;
        }

        .comment-list {
            width: 100%;
            max-width: 800px;
            margin: auto;
        }
        .comment-list .comment {
            display: flex;
            flex-direction: row;
        }
        .comment-list .comment-item {
            margin-right: 20px;
        }
        .comment-list .comment-item.star {
            width: 150px;
        }
        .comment-list .comment-item.text {
            flex-grow: 1;
        }
        #map {
            display: none;
        }
        #score_average {
            width: 800px;
            height: 50px;
            margin: auto;
        }

    </style>
    <script>

        let map_count = 0
        $(document).ready(function () {
            //comments
            get_posts()
            // map Î≥¥Ïó¨Ï£ºÍ∏∞
            get_map()
        });

        function hey_map() {
            if (map_count == 0) {
                $('#map').show()
                map_count += 1
            }else {
                $('#map').hide()
                map_count -= 1
            }
        }
        function get_map() {
            let x = {{ addr_x|tojson }};
            let y = {{ addr_y|tojson }};
            let map = new naver.maps.Map('map', {
                center: new naver.maps.LatLng(y, x),
                zoom: 18,
                zoomControl: true,
                zoomControlOptions: {
                    style: naver.maps.ZoomControlStyle.SMALL,
                    position: naver.maps.Position.TOP_RIGHT
                }
            });
            let marker = new naver.maps.Marker({
                position: new naver.maps.LatLng(y, x),
                map: map
            });
        }

        function saveimg() {
            // alert("hedd!")
            let mm_no = {{ museum.index|tojson }}


            let file = $('#inputGroupFile04')[0].files[0]
            let form_data = new FormData()

            form_data.append("file_give", file)
            form_data.append("mmnum_give", mm_no)

            $.ajax({
                type: "POST",
                url: "/saveimg",
                data: form_data,
                cache: false,
                contentType: false,
                processData: false,
                success: function (response) {
                    alert(response["msg"])
                    window.location.reload()
                }
            });
        }

        function post() {
            let comment = $("#textarea-post").val()
            let score = $('#inputGroupSelect01').val()
            let today = new Date().toISOString()
            let name = 'Î∞ïÏòàÏä¨'
            let mm_no = {{ museum.index|tojson }}

            // alert(mm_no)

            if (score == 'Î≥ÑÏ†êÏ£ºÍ∏∞') {
                alert('Î≥ÑÏ†êÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî')
                return
            }else if (comment == "") {
                alert('ÎÇ¥Ïö©ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî')
                return
            }
            // score = Number(score)
            // console.log(typeof(comment), typeof(score))
            $.ajax({
                type: "POST",
                url: "/posting",
                data: {
                    mmnum_give: mm_no,
                    name_give: name,
                    score_give: score,
                    comment_give: comment,
                    date_give: today
                },
                success: function (response) {
                    window.location.reload() // ÏÉàÎ°úÍ≥†Ïπ®
                }
            })
        }

        function get_posts() {
            $("#comment-list").empty()
            $.ajax({
                type: "GET",
                url: "/get_posts?num_give="+'{{museum.index}}',
                data: {},
                success: function (response) {
                    if (response["result"] == "success") {
                        let posts = response["posts"]
                        // console.log(posts)
                        let score_sum = 0
                        let score_average = 0
                        for (let i = 0; i < posts.length; i++) {
                            let post = posts[i]
                            let star_image = '‚≠ê'.repeat(post["score"])
                            // let time_post = new Date(post["date"])
                            score_sum += Number(post["score"])
                            score_average = score_sum / ( i + 1 )
                            // console.log(score_sum, score_average.toFixed(1))
                            let html_temp = `<div class="comment" id='${post["_id"]}'>
                                                <div class="comment-item star">${star_image}</div>
                                                <div class="comment-item text">${post["comment"]}</div>
                                                <div class="comment-item name">${post["username"]}</div>
                                                <button type="button" class="btn-close" aria-label="Close" onclick="delete_test('${post["_id"]}')"></button>
                                            </div>
                                            <hr>`
                            $("#comment-list").append(html_temp)
                        }
                        let html_temp = `<p>ÌèâÏ†ê (${score_average.toFixed(1)})</p>`
                        $('#score_average').append(html_temp)

                    }
                }
            })
        }
        function delete_test(post_id) {
            console.log(post_id)
            $.ajax({
                type: "POST",
                url: "/delete?num_give="+'{{museum.index}}',
                data: {
                    post_id_give: post_id,
                },
                success: function (response) {
                    alert(response["msg"])
                    window.location.reload()
                }
            });
        }

        function delete_post(post_id) {
            // GETÏù¥ ÏïÑÎãå DELETEÎ°ú ÏãúÎèÑ
            $.ajax({
                type: "DELETE",
                url: "/delete_post?post_id="+post_id,
                data: {},
                success: function (response) {
                    window.location.reload() // ÏÉàÎ°úÍ≥†Ïπ®
                }
            })
        }

        function insert_pic() {
            alert('ÏÇ¨ÏßÑÏùÑ ÎÑ£Ïñ¥Î≥ºÍπå?');
        }

    </script>
</head>

<body>

<!--HEADER-->
<div class="mytitle">
    <div class="inner">

        <a href="/" class="logo"><p>MUMA</p></a>
        <div class="sub-menu">
            <div class="search">
                <input type="text"/>
                <button class="search-btn">ÌöåÏõêÏ†ïÎ≥¥</button>
            </div>
            <button class="logout-btn">Î°úÍ∑∏ÏïÑÏõÉ</button>
        </div>

    </div>
</div>

<!--MAIN DB-->
<div class="showdb">
    <div class="dbinfo">

        <div class="dbimg">
            {% if img != None %}
            <img src="/static/{{ img.file }}" alt="aba"/>
            {% endif %}

            {% if img == None %}
            <img src="/static/museum-art.png" alt="aba"/>
            {% endif %}

        </div>
        <div class="dbmain" id="museum_maindb">
                <div class="db-head">
                    <h1 class="name">{{ museum.name }}</h1>
                    <p class="type">#{{ museum.type }}</p>
                </div>
                <p><span class="info_head">ÌôàÌéòÏù¥ÏßÄ</span> : {{ museum.url }}</p>
                <p><span class="info_head">Ï†ÑÌôîÎ≤àÌò∏</span> : {{ museum.phone }}</p>
                <p><span class="info_head">ÏòÅÏóÖÏãúÍ∞Ñ</span> : {{ museum.open }} ~ {{ museum.close }}</p>
                <p><span class="info_head">Ìú¥Î¨¥Ï†ïÎ≥¥</span> : {{ museum.rest_info }}</p>
                <p><span class="info_head">Ï£º ÏÜå</span> : {{ museum.addr }}</p>
                <p><a href="javascript:void(0);" id="show_map" class="show_map" onclick="hey_map()">üëâ ÏßÄÎèÑÎ°ú Î≥¥Í∏∞</a></p>
                <p class="db-intro">{{ museum.introduce }}</p>

                <div class="input-group">
                    <input type="file" class="form-control" id="inputGroupFile04"
                           aria-describedby="inputGroupFileAddon04" aria-label="Upload">
                    <button class="btn btn-outline-secondary" type="button" id="inputGroupFileAddon04" onclick="saveimg()">ÏÇ¨ÏßÑ Îì±Î°ù</button>
                </div>
            </div>

    </div>
</div>

<!--MAP-->
<div id="map"></div>


<!--COMMENT-->
<div class="mycomment">
    <div class="mystar">
        <select class="form-select" id="inputGroupSelect01" aria-label="Default select example">
            <option selected>Î≥ÑÏ†êÏ£ºÍ∏∞</option>
            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
            <option value="3">‚≠ê‚≠ê‚≠ê</option>
            <option value="2">‚≠ê‚≠ê</option>
            <option value="1">‚≠ê</option>
        </select>
    </div>
    <div class="input-group mb-3">
        <input type="text" class="form-control" id="textarea-post" placeholder="ÏùòÍ≤¨ÏùÑ ÏûêÏú†Î°≠Í≤å Ï†ÅÏñ¥Ï£ºÏÑ∏Ïöî." aria-label="Recipient's username"
               aria-describedby="button-addon2">
        <button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="post()">ÏûÖÎ†•</button>
    </div>

</div>
<div id="score_average">
<!--    <p>ÌèâÏ†ê ()</p>-->
</div>
<div class="comment-list" id="comment-list">
    <div class="comment">
        <div class="comment-item star">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        <div class="comment-item text">ÏΩîÎ©òÌä∏etsetsetset</div>
        <div class="comment-item name">ÎãâÎÑ§ÏûÑ</div>
    </div>
    <hr>
    <div class="comment">
        <div class="comment-item star">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        <div class="comment-item text">ÏΩîÎ©òÌä∏etsetsetset</div>
        <div class="comment-item name">ÎãâÎÑ§ÏûÑ</div>
        <button type="button" class="btn-close" aria-label="Close"></button>
    </div>
    <hr>
</div>

</body>

</html>