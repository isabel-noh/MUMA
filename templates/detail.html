<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!--    og íƒœê·¸-->
    <meta property="og:title" content="MUMA(Museum Masters)" />
    <meta property="og:description" content="ë®¤ì§€ì—„ ë§ˆìŠ¤í„°ë“¤ì„ ìœ„í•œ ë°•ë¬¼ê´€ì— ëŒ€í•œ ì •ë³´ë¥¼ ê³µìœ í•˜ê³  í›„ê¸°ë¥¼ ë‚¨ê¸°ëŠ” ê³µê°„ì…ë‹ˆë‹¤." />
    <meta property="og:image" content="{{ url_for('static', filename='museum-art.png') }}" />

<!--    íŒŒë¹„ì½˜ ì—°ê²°-->
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">

    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

<!--    ë„¤ì´ë²„ ì§€ë„ api -->
    <script type="text/javascript"
            src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=afrl6tl1y2"></script>
    <script src=" https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<!--    íƒ­ì— í˜ì´ì§€ì— í•´ë‹¹í•˜ëŠ” ë°•ë¬¼ê´€ ì´ë¦„ ëœ¨ê²Œí•˜ê¸°-->
    <title>MUMA | {{ museum.name}} </title>


    <style>
        /*COMMON*/
        body {
            font-size: 16px;
            font-weight: 400;
            line-height: 1.2;
            font-family: 'Nanum Gothic', sans-serif;
            color: #333333;
        }
        hr {
            width: 100%;
            max-width: 800px;
        }
        #map {
            width: 100%;
            max-width: 800px;
            height: 400px;
            margin: 35px auto;

            display: none;
        }

        /*HEADER*/
        .mytitle {
            background-color: whitesmoke;
            font-size: 14px;
        }
        .mytitle .inner {
            width: 100%;
            max-width: 800px;
            height: 80px;
            margin: 0 auto;
            position: relative;
        }
        .mytitle .logo {
            height: 40px;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            margin: auto;
            font-size: 24px;
            color: #333333;
            text-decoration: none;
        }
        .mytitle .sub-menu {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            margin: auto;
            height: 40px;
            display: flex;
            flex-direction: row;
        }
        .mytitle .sub-menu .search input {
            width: 200px;
            height: 40px;
            padding: 2px 10px;
            border-radius: 5px;
            outline: none;
            background-color: white;
            color: gray;
            font-size: 14px;
            border: 1px solid #b0b0b0;
        }
        .mytitle .sub-menu .search .search-btn {
            width: 100px;
            height: 40px;

            background-color: #0066cc;
            color: white;
            border-radius: 5px;
            border: 1px solid #0066cc;
        }
        .mytitle .sub-menu .search .search-btn:hover {
            background-color: #333333;
            border: 1px solid #333333;
        }
        .mytitle .sub-menu .logout-btn {
            width: 100px;
            height: 40px;

            margin-left: 3px;
            background-color: #b0b0b0;
            color: white;
            border-radius: 5px;
            border: 1px solid #b0b0b0;
        }
        .mytitle .sub-menu .logout-btn:hover {
            background-color: #333333;
        }


        /*MAIN DB SHOW*/
        .showdb {
            margin-top: 50px
        }
        .showdb .dbinfo {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: row;
        }
        .showdb .dbinfo .dbimg img {
            background-color: orange;
            width: 100%;
            min-width: 350px;
            height: auto;
            flex-grow: 1;
            object-fit: contain;
        }

        .showdb .dbinfo .dbmain {
            overflow: hidden;
            margin-top: 10px;
            min-width: 350px;
            width: 100%;
            padding-left: 35px;
            flex-grow: 1;
        }
        .showdb .dbinfo .dbmain .db-head {
            display: flex;
            flex-direction: row;
            margin-bottom: 10px;
        }
        .showdb .dbinfo .dbmain .info_head {
            font-weight: 700;
        }
        .showdb .dbinfo .dbmain .type {
            color: #0066cc;
            font-size: 16px;
            font-weight: 700;
            font-style: italic;
            margin-top: 5px;
            margin-left: 15px;
        }
        .showdb .dbinfo .dbmain .name {
            font-size: 24px;
            font-weight: 700;
        }
        .showdb .dbinfo .dbmain .db-intro {
            line-height: 1.6;
        }

        .showdb .dbinfo .dbmain .show_map {
            text-decoration : none;
        }

        .showdb .dbinfo .dbmain .input-group {
            margin-top: 30px;
        }

        .showdb .dbinfo btns {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: auto;
        }


        /*COMMENT*/
        .mycomment {
            width: 100%;
            max-width: 800px;
            margin: 35px auto;
            display: flex;
            flex-direction: row;
            align-items: center;
            position: relative;
        }
        .mycomment .mystar .form-select {
            color: gray;
            outline: none;
            box-shadow: none;
            width: 150px;
        }
        .mycomment .input-group {
            margin-top: 16px;
            margin-left: 10px;
        }
        .mycomment .input-group .form-control {
            outline: none;
            box-shadow: none;
        }
        .mycomment .input-group .btn-outline-secondary {
            border: 1px solid lightgray;
            outline: none;
            box-shadow: none;
        }
        .mycomment .input-group .btn-outline-secondary:hover {
            background-color: #333333;
            border: 1px solid #333333;
        }

        .comment-list {
            width: 100%;
            max-width: 800px;
            margin: auto;
        }
        .comment-list .comment {
            display: flex;
            flex-direction: row;
        }
        .comment-list .comment-item {
            margin-right: 20px;
        }
        .comment-list .comment-item.star {
            width: 150px;
        }
        .comment-list .comment-item.text {
            flex-grow: 1;
        }
        #score_average {
            width: 800px;
            height: 50px;
            margin: auto;
        }

    </style>
    <script>

        let map_count = 0
        $(document).ready(function () {
            // ëŒ“ê¸€ ë³´ì—¬ì£¼ê¸°
            get_posts()
            // map ë³´ì—¬ì£¼ê¸°, ì§€ë„ë¥¼ ê·¸ë ¤ëŠ” ì£¼ëŠ”ë°, í˜„ì¬ ì§€ë„ display:none ìƒíƒœë¡œ ì²˜ìŒì—” ì•ˆë³´ì´ê²Œ í•˜ê¸°
            get_map()
        });

        function hey_map() {        // ë§µì„ ë¶ˆëŸ¬ì™€ì„œ ë³´ì—¬ì£¼ê±°ë‚˜, ìˆ¨ê¸´ë‹¤
            if (map_count == 0) {   // script ì²˜ìŒì—ì„œ ì„ ì–¸í•´ì¤€ map_cout ì´ìš©, í´ë¦­ìˆ˜ì— ë”°ë¼, 0ì¼ë•Œ ë³´ì—¬ì£¼ê³ , 1ì¼ë•Œ ìˆ¨ê¸°ê²Œ
                $('#map').show()
                map_count += 1
            }else {
                $('#map').hide()
                map_count -= 1
            }
        }

        function get_map() {          // detail.html ë¡œ ì—°ê²°í•˜ë©´ì„œ ê°€ì ¸ì˜¨ ìœ„ë„, ê²½ë„ ê°’ x, y ì´ìš©
            let x = '{{ addr_x }}';   // Jinja2 í…œí”Œë¦¿ ì–¸ì–´ ì´ìš©
            let y = '{{ addr_y }}';
            let map = new naver.maps.Map('map', {
                center: new naver.maps.LatLng(y, x),
                zoom: 18,
                zoomControl: true,
                zoomControlOptions: {
                    style: naver.maps.ZoomControlStyle.SMALL,
                    position: naver.maps.Position.TOP_RIGHT
                }
            });
            let marker = new naver.maps.Marker({
                position: new naver.maps.LatLng(y, x),
                map: map
            });
        }

        function save_img() {
            let test = $('#inputGroupFile04').val()
            console.log(test)

            if (test == "") {     // ì¼ë‹¨ inputì°½ì— ì‚¬ì§„ ì •ë³´ê°€ ì—†ìœ¼ë©´ ì‚¬ì§„ì´ ì˜¬ë¼ì™€ìˆì§€ ì•Šì€ ê²ƒ
                alert('[íŒŒì¼ ì„ íƒ]ì„ ëˆŒëŸ¬ ì‚¬ì§„ì„ ë“±ë¡í•˜ì„¸ìš”!');
                return
            } else {
                let mm_no = '{{ museum.index }}'    // í˜„ì¬í˜ì´ì§€ì˜ ë°•ë¬¼ê´€ indexë¥¼ ì‚¬ì§„ ì •ë³´ì™€ í•¨ê»˜ ë³´ë‚´ê¸° ìœ„í•´ ë°›ì•„ì˜´

                let file = $('#inputGroupFile04')[0].files[0]
                let form_data = new FormData()

                form_data.append("file_give", file)
                form_data.append("mmnum_give", mm_no)

                $.ajax({
                    type: "POST",
                    url: "/save_img",
                    data: form_data,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        alert(response["msg"])
                        window.location.reload()
                    }
                });
            }
        }

        function post() {
            let comment = $("#textarea-post").val()
            let score = $('#inputGroupSelect01').val()
            let today = new Date().toISOString()
            let name = 'ë°•ì˜ˆìŠ¬'
            let mm_no = {{ museum.index|tojson }}

            if (score == 'ë³„ì ì£¼ê¸°') {
                alert('ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”')
                return
            }else if (comment == "") {
                alert('ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”')
                return
            }

            $.ajax({
                type: "POST",
                url: "/posting",
                data: {
                    mmnum_give: mm_no,
                    name_give: name,
                    score_give: score,
                    comment_give: comment,
                    date_give: today
                },
                success: function (response) {
                    window.location.reload() // ìƒˆë¡œê³ ì¹¨
                }
            })
        }

        function get_posts() {
            $("#comment-list").empty()
            $.ajax({
                type: "GET",
                url: "/get_posts?num_give="+'{{museum.index}}',
                data: {},
                success: function (response) {
                    if (response["result"] == "success") {
                        let posts = response["posts"]
                        let score_sum = 0
                        let score_average = 0
                        for (let i = 0; i < posts.length; i++) {
                            let post = posts[i]
                            let star_image = 'â­'.repeat(post["score"])
                            score_sum += Number(post["score"])
                            score_average = score_sum / ( i + 1 )
                            let html_temp = `<div class="comment" id='${post["_id"]}'>
                                                <div class="comment-item star">${star_image}</div>
                                                <div class="comment-item text">${post["comment"]}</div>
                                                <div class="comment-item name">${post["username"]}</div>
                                                <button type="button" class="btn-close" aria-label="Close" onclick="delete_test('${post["_id"]}')"></button>
                                            </div>
                                            <hr>`
                            $("#comment-list").append(html_temp)
                        }
                        let html_temp = `<p>í‰ì  (${score_average.toFixed(1)})</p>`
                        $('#score_average').append(html_temp)

                    }
                }
            })
        }
        function delete_test(post_id) {
            console.log(post_id)
            $.ajax({
                type: "POST",
                url: "/delete?num_give="+'{{museum.index}}',
                data: {
                    post_id_give: post_id,
                },
                success: function (response) {
                    alert(response["msg"])
                    window.location.reload()
                }
            });
        }

        function delete_post(post_id) {
            // GETì´ ì•„ë‹Œ DELETEë¡œ ì‹œë„
            $.ajax({
                type: "DELETE",
                url: "/delete_post?post_id="+post_id,
                data: {},
                success: function (response) {
                    window.location.reload() // ìƒˆë¡œê³ ì¹¨
                }
            })
        }

    </script>
</head>

<body>

<!--HEADER-->
<div class="mytitle">
    <div class="inner">

        <a href="/" class="logo"><p>MUMA</p></a>
        <div class="sub-menu">
            <div class="search">
                <input type="text"/>
                <button class="search-btn">íšŒì›ì •ë³´</button>
            </div>
            <button class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

    </div>
</div>

<!--MAIN DB-->
<div class="showdb">
    <div class="dbinfo">

        <div class="dbimg">     <!--í˜ì´ì§€ ì—´ë•Œ ê°€ì ¸ì˜¨ img dbì—ì„œ ê°’ì´ ìˆì„ ë•Œë§Œ, í•´ë‹¹ ì‚¬ì§„ ë³´ì—¬ì£¼ê¸°, ì—†ìœ¼ë©´ ê¸°ë³¸ ì‚¬ì§„-->
            {% if img == [] %}
            <img src="/static/museum-art.png" alt="aba"/>
            {% else %}
            <img src="/static/{{ img.file }}" alt="aba"/>
            {% endif %}

        </div>
        <div class="dbmain" id="museum_maindb">
            <div class="db-head">
                <h1 class="name">{{ museum.name }}</h1>
                <p class="type">#{{ museum.type }}</p>
            </div>
            <p><span class="info_head">í™ˆí˜ì´ì§€</span> : {{ museum.url }}</p>
            <p><span class="info_head">ì „í™”ë²ˆí˜¸</span> : {{ museum.phone }}</p>
            <p><span class="info_head">ì˜ì—…ì‹œê°„</span> : {{ museum.open }} ~ {{ museum.close }}</p>
            <p><span class="info_head">íœ´ë¬´ì •ë³´</span> : {{ museum.rest_info }}</p>
            <p><span class="info_head">ì£¼ ì†Œ</span> : {{ museum.addr }}</p>
            <p><a href="javascript:void(0);" id="show_map" class="show_map" onclick="hey_map()">ğŸ‘‰ ì§€ë„ë¡œ ë³´ê¸°</a></p>
            <p class="db-intro">{{ museum.introduce }}</p>

            <div class="input-group">
                <input type="file" class="form-control" id="inputGroupFile04"
                       aria-describedby="inputGroupFileAddon04" aria-label="Upload">
                <button class="btn btn-outline-secondary" type="button" id="inputGroupFileAddon04" onclick="save_img()">
                    ì‚¬ì§„ ë“±ë¡
                </button>
            </div>
        </div>

    </div>
</div>

<!--MAP-->
<div id="map"></div>


<!--COMMENT-->
<div class="mycomment">
    <div class="mystar">
        <select class="form-select" id="inputGroupSelect01" aria-label="Default select example">
            <option selected>ë³„ì ì£¼ê¸°</option>
            <option value="5">â­â­â­â­â­</option>
            <option value="4">â­â­â­â­</option>
            <option value="3">â­â­â­</option>
            <option value="2">â­â­</option>
            <option value="1">â­</option>
        </select>
    </div>
    <div class="input-group mb-3">
        <input type="text" class="form-control" id="textarea-post" placeholder="ì˜ê²¬ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”." aria-label="Recipient's username"
               aria-describedby="button-addon2">
        <button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="post()">ì…ë ¥</button>
    </div>

</div>
<div id="score_average">
<!--    <p>í‰ì  ()</p>-->
</div>
<div class="comment-list" id="comment-list">
    <div class="comment">
        <div class="comment-item star">â­â­â­â­â­</div>
        <div class="comment-item text">ì½”ë©˜íŠ¸etsetsetset</div>
        <div class="comment-item name">ë‹‰ë„¤ì„</div>
    </div>
    <hr>
    <div class="comment">
        <div class="comment-item star">â­â­â­â­â­</div>
        <div class="comment-item text">ì½”ë©˜íŠ¸etsetsetset</div>
        <div class="comment-item name">ë‹‰ë„¤ì„</div>
        <button type="button" class="btn-close" aria-label="Close"></button>
    </div>
    <hr>
</div>

</body>

</html>